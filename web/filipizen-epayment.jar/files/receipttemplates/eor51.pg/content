
<link href="/res/epayment/eor.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>



<script>
\$put("eor51", new function() {
	var self = this;
	var root = \$get("eor").code; 
	this.agency = root.agency;
	this.receipt = root.receipt;

	this.onload = function() {
		if(this.receipt == null ) {
			root.loadReceipt(function(v) {
				self.receipt = v;
				self._controller.refresh();	
			});
		}
	}

});
</script>

<button onclick="generate()">Generate PDF</button>
<div id="html-2-pdfwrapper" style='position: absolute; left: 20px; top: 50px; bottom: 0; overflow: auto;'>
	<div r:context="eor51">
		<div class="box-eor">
			<div class="col-md-12" style="border:1px solid lightgrey;padding-top:30px;">
			    <div class="row">
			        <div class="receiptinfo col-md-7">
			            EOR No.: 
			            <h1 class="eorno"><label r:context="eor51">#{receipt.receiptno}</label></h1>
			            <strong>Paid By : </strong> <label r:context="eor51">#{receipt.paidby}</label><br />
			            <strong>Address: </strong><label r:context="eor51">#{receipt.paidbyaddress}</label><br />
			            <strong>Particulars: </strong> <label r:context="eor51">#{receipt.remarks}</label><br />
			            <strong>Agency: </strong> <label r:context="eor51">#{agency.title}, #{agency.group.title}</label>
			        </div>
			        <div class="qrdata col-md-5">
			        	<img id='qrcode' src="https://api.qrserver.com/v1/create-qr-code/?data=${PARAMS.receiptno}&amp;size=250x250" width="150" height="150" class="img-responsive"/>					
			            <div id="output"></div>
			        </div>
			    </div>
			    <hr>
			    <div class="row">
			        <div class="col-md-6">
			            <strong>PAYMENT DETAILS :</strong>
			        </div>
			    </div>
			    <hr>
			    <div class="row">
			        <div class="col-lg-12 col-md-12 col-sm-12">
			            <div class="table-responsive">
			                <table class="table table-bordered" r:context="eor51" r:items="receipt.items" r:varName="item">
			                    <thead>
				                    <tr>
				                        <th class="text-left" style="padding-left:15px;">Account</th>
				                        <th class="text-right" style="padding-right:15px;" maxWidth="100">Amount</th>
				                    </tr>
			                    </thead>
			                    <tbody>
				                    <tr> 
				                        <td class="text-left" style="padding-left:15px;"> #{item.item.title} #{item.remarks}</td> 
				                        <td class="text-right" style="padding-right:15px;"> #{ item.amount.formatDecimal() } </td> 
				                    </tr> 
			                    </tbody>
			                </table>
			            </div>
			            
			            <hr>
			            <div>
			                <h4>  TOTAL : Php  <label r:context="eor51">#{ receipt.amount.formatDecimal() }</label></h4>
			            </div>

			            <hr>
			            <div>
			                <h4>  Amount in words : <label r:context="eor51">#{receipt.amountinwords}</label> </h4>
			            </div>

			            <hr>
			        </div>
			    </div>

			    <div class="row">
			        <div class="col-lg-12 col-md-12 col-sm-12">
			            <strong>Bank : </strong>  <label r:context="eor51">#{receipt.partner.name}</label>
			            <br />
			            <strong>Txn No.: </strong> <label r:context="eor51">#{receipt.traceid}</label> 
			            <br />
			            <strong>Txn Date: </strong> <label r:context="eor51">#{receipt.tracedate}</label>
			        </div>
			    </div>
			    <hr>
			    
			</div>
		</div>

		 <!--
		<div style="margin:30px 0px 0px 200px">
			<div class="row">
		        <div class="col-lg-12 col-md-12 col-sm-12">
		            <button onclick="location.href='javascript:window.print()';" href="" class="btn btn-primary btn-sm btn-eor" >Print EOR</button> &nbsp; &nbsp; &nbsp;
		           <button  class="btn btn-info btn-sm btn-eor">Download In Pdf</button>
		        </div>
		    </div>
	    </div>-->
	</div>
</div>

<script>
var base64Img = null;
imgToBase64('octocat.jpg', function(base64) {
    base64Img = base64; 
});

margins = {
  top: 70,
  bottom: 40,
  left: 30,
  width: 550
};

generate = function()
{
	var pdf = new jsPDF('p', 'pt', 'a4');
	pdf.setFontSize(18);
	pdf.fromHTML(document.getElementById('html-2-pdfwrapper'), 
		margins.left, // x coord
		margins.top,
		{
			// y coord
			width: margins.width// max width of content on PDF
		},function(dispose) {
			headerFooterFormatting(pdf, pdf.internal.getNumberOfPages());
		}, 
		margins);
		
	var iframe = document.createElement('iframe');
	iframe.setAttribute('style','position:absolute;right:0; top:0; bottom:0; height:100%; width:650px; padding:20px;');
	document.body.appendChild(iframe);
	
	iframe.src = pdf.output('datauristring');
};
function headerFooterFormatting(doc, totalPages)
{
    for(var i = totalPages; i >= 1; i--)
    {
        doc.setPage(i);                            
        //header
        header(doc);
        
        footer(doc, i, totalPages);
        doc.page++;
    }
};

function header(doc)
{
    doc.setFontSize(30);
    doc.setTextColor(40);
    doc.setFontStyle('normal');
	
    if (base64Img) {
       doc.addImage(base64Img, 'JPEG', margins.left, 10, 40,40);        
    }
	    
    doc.text("Report Header Template", margins.left + 50, 40 );
	doc.setLineCap(2);
	doc.line(3, 70, margins.width + 43,70); // horizontal line
};

// You could either use a function similar to this or pre convert an image with for example http://dopiaza.org/tools/datauri
// http://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript
function imgToBase64(url, callback, imgVariable) {
 
    if (!window.FileReader) {
        callback(null);
        return;
    }
    var xhr = new XMLHttpRequest();
    xhr.responseType = 'blob';
    xhr.onload = function() {
        var reader = new FileReader();
        reader.onloadend = function() {
			imgVariable = reader.result.replace('text/xml', 'image/jpeg');
            callback(imgVariable);
        };
        reader.readAsDataURL(xhr.response);
    };
    xhr.open('GET', url);
    xhr.send();
};

function footer(doc, pageNumber, totalPages){

    var str = "Page " + pageNumber + " of " + totalPages
   
    doc.setFontSize(10);
    doc.text(str, margins.left, doc.internal.pageSize.height - 20);
    
};

 </script>


