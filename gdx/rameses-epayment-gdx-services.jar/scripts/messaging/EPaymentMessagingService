import com.rameses.annotations.*
import com.rameses.util.*
import com.rameses.common.*
import com.rameses.services.extended.*

class EPaymentMessagingService  {

	@Service(value="OnlinePaymentService", connection="local-epayment")
    def localSvc;

	@Service(value="CloudPaymentService", connection="cloud-epayment")
    def cloudSvc;

    @OnMessage(value="gdx-mq-client", eval="#{data.action == 'epayment:post-payment'}")
    public def onReceivePayment(def p) {
        def r = localSvc.postPayment( p );
        if(r !=null ) {
            cloudSvc.updatePaymentReceipt( r );
        }
        else {
            //this should be fire and forget...
            return [status: "error"]
        }
    }

    @OnMessage(value="gdx-mq-client", eval="#{data.action == 'epayment:cancel-payment-order'}")
    public def onCancelPayment(def p) {
        localSvc.cancelPaymentOrder( [refno: p.refno ]);
    }

}

